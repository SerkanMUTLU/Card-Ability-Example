<import name="card_title" src="./common/component/card_title/card_title.ux"></import>
<import name="card_bottom_3" src="./common/component/card_bottom_3/card_bottom_3.ux"></import>
<template>
    <div class="newsandinformationtype_box" widgetid="fd112a16-ed5d-4e4c-b068-87dd80bd27c2">
        <card_title title="{{currencyCardTitle}}"></card_title>
        <div class="newsandinformationtype_content_box">
            <block for="{{currencies}}">
                <div class="{{dividings[$idx]}} newsandinformationtype_item_box">
                    <div style="flex-direction: column;flex:1;align-self: flex-end;">
                        <div style="flex: 1;align-items: flex-start;">
                            <text class="newsandinformationtype_textSizeBody2 newsandinformationtype_textColorPrimary newsandinformationtype_textMedium newsandinformationtype_lineTwo newsandinformationtype_marginVerticalM">{{$item.rate}}</text>
                        </div>
                        <text class="newsandinformationtype_textColorTertiary newsandinformationtype_textSizeCaption">{{UpdatedTime}}</text>
                    </div>
                    <image src="{{$item.imgUrl}}" class="newsandinformationtype_img newsandinformationtype_marginHorizontalL"></image>
                </div>
            </block>
        </div>
        <card_bottom_3 button-array="{{currencyCardButton}}" onclick="redirectToApp"></card_bottom_3>
    </div>

</template>
<style lang="sass">
    @import "./common/css/basic.scss";

    .newsandinformationtype_box {
        flex-direction: column;
        padding: dpConvert(0) dpConvert($elementsMarginHorizontalL) dpConvert(0) dpConvert($elementsMarginHorizontalL);
    }

    .newsandinformationtype_content_box {
        flex-direction: column;
    }

    .newsandinformationtype_dividing {
        border-bottom-color: $color10;
        border-bottom-width: 1px;
    }

    .newsandinformationtype_item_box {
        padding: dpConvert(12) dpConvert(0) dpConvert(12) dpConvert(0);
    }
    
    .newsandinformationtype_img {
        width: dpConvert(64);
        height: dpConvert(40);
        border-radius: dpConvert(4);
    }

    .newsandinformationtype_textColorPrimary {
        color: $textColorPrimary;
    }

    .newsandinformationtype_textColorTertiary {
        color: $textColorTertiary;
    }

    .newsandinformationtype_textSizeBody2 {
        font-size: dpConvert(16);
    }

    .newsandinformationtype_textSizeCaption {
        font-size: dpConvert(12);
    }

    .newsandinformationtype_textMedium {
        font-weight: 500;
    }

    .newsandinformationtype_marginVerticalM {
        margin-bottom: dpConvert($elementsMarginVerticalM);
    }

    .newsandinformationtype_marginHorizontalL {
        margin-left: dpConvert($elementsMarginHorizontalL);
    }

    .newsandinformationtype_lineTwo {
        lines: 2;
        text-overflow: ellipsis;
    }
</style>

<script>
    import fetch from '@system.fetch'
    import router from "@system.router"
    import app from "@system.app";
    import pkg from "@system.package";

    const currencyPageUri ="referenceapp://bank/currencies"//DeepLink of Currency Page
    const packageName = "com.dtse.banking";
    module.exports = {
        data: {
            currencies:[
                {"name":"GBP","rate":"0.00","imgUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAFY0lEQVR42u2baYgcVRSFbxJQ4zIqREXUBP2hqEncBUGDRMQFEcQl4oKJ/nEDg1EUFUlASQRFBHVcwETFFUTF/IgruOSHS1xwQzQ4JMExKrjghsbEc3hTmerq6u7prhrP7fF+cJjuanhzX516+61JFkiZpA7g/04YICYMEBMGiAkDxIQBYsIAMWGAmDBATBggJgwQEwaICQPEhAFiwgAxYYCYMEBMGCAmDBATBogJA8SEAWLCADH9YsBk6GBoLnToiIp8DH0GvQatgf5RBz0WvBuwLTQfugyanYt5S4fPQ9BD0P3Q9+pKtMOzASdBd0EHVChjI3QF9Iy6Mq3wasAS6EZLXU8WZ6envtVncp8lI7aYMzwasBS6zsZ2c9dD20B7WHsD+P1e6EpzZoI3A/iU3t3m93XQA9Aq6CvoZ2gKtCN0NHQhNM+SKWWcCz2lrmQeTwbMgD6CBnKxZU/rZugW6Fbo7w7lHAU9Ce1bqCfL+hE6yNLY4AJPBgxCl1pzN7IJWgA91kVZ0yxNSacVyiLLoBvUlc3wYsB2lp7KgZLfroHu6KHME6GXSq4PW2ptnVrSf4IXA86CnrbmgfRLSwuwXm8WF2XHl5Q7B3pTXeksGA/cDC225ht1PXRbhXI56D5eUi7/1xJ1pbNgPLDc0oq3yBHQ+xXK3clS1za1cP056Ax1pYknAy6y5vn79tCfFcvmzGq2NbaAIWucJcnwbsDk3oprgHtCC6zRgA3QdHOwKPNkwPyS67OgTyqWfSe0sOT6LpYWclK8GHCVpRtVHCzPg56oWDbXFoPWvL7Y1cKArXDO/qI1G8CWcXHFsnew0QVZnnUWXdBWuJczPPI3b8B30H7Qb+oAxwsvBpBHoQtKrnNwfkQd3HjhyYBjoLdyMWXdEXc9uYG2SR3geODJAPIGdGwutqw74jiwQh3ceODNAG4lv1Nyna2AR5Ob1QHWjQcDzoRuz32fkYstPyB/A/3VoaxfoEPUFeoGDwZwkF2ei6fXs19+/snS/L5v8GLAiprKCgN6oGyhxDPdty1tF2Rx8kn/HDrNWo8FvL5eXaFu8GBAKx6ELsnFmXU1HKjXqIOrC88G8NTq9ZLrPJi/SR1cXXg2gLBPH7DGFsA9o1PUgdWFdwNWQqdaowE8YDlMHVhdeDeg7JyA2xXHqQOri34woHhS9rClE64JgXcD3oMOt0YDmL44qA6sLjwbwPXBr4VrnOfPtLQemBB4NuAcSzmeWZxsAc+bk3SSuvBswGpLZwRZnDwPYAb0B+rA6sSrAWdbSlXMw0y2xerA6sajAXtb2mrY3UYH3hcs5Y+6SKitE28GMEuaL1/MsdF+/xVLG3CdzgL6Ek8GMA2RT/rc3DUOuswNOtDSUeXOllIKP7RkCFvKpzb2rIn9Le0jMVfod3WFiRcD9rSUFXGCjXY7HAOGoPMtdUutDmH+sLQ98bKl1sNt7OI7wuzO+KrrtZamt0wCu1pd6awCajiv543bq3CdN3FKD+X9AL0LfTHynTOnI63xvTGuJ9jNrVZX3oMB7Pd5ED/Tqh9JtntLsvjbWnNw0O/BAMLdTW6ycRzI3yimpn9rKSuCOf5sJdOtOXeo3edWv7GlnGzV3j+ojBcDyOXQPSOfOcjyZbpXLd2oPDwfYJfCfNLTLSVtdcuz0CLoa3WlPRlA+EY7T8G6yYjex9LMieJMiQM2+/vsiedYwixozpjYyvjK0lp1RTO8GVAHu1nqyjI4XR1WB9WKiWhAXxEGiAkDxIQBYsIAMWGAmDBATBggJgwQEwaICQPEhAFiwgAxYYCYMEBMGCAmDBATBogJA8SEAWLCADFhgJgwQEwYICYMEPMvzBj7YdwffSsAAAAASUVORK5CYII="},
                {"name":"EUR","rate":"0.00","imgUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAE2UlEQVR42u2cW4hVVRzG/2pekjCExMugBInh5cULIl4SDaEbgwnlk04g+JBQWoIE+qIgKFgPvlQ+JF0I0iijQh8aR5AKbw9GCoKI90kLyczbFNP3sc5mNvucPXOOZ3bfOsf/Dz7mjOecPWvt39l77bPWfzvAHCkD1A142HEBYlyAGBcgxgWIcQFiXIAYFyDGBYhxAWJcgBgXIMYFiHEBYlyAGBcgxgWIcQFiXIAYFyDGBYhxAWJcgBgXIKaRBbQgC5CZyETkUeRp5E/kHHIBOY60I5fUjc2jEQUsRd5C5iCDq3j9v8hJ5EPkE+RvdQfSNJKA2cjO0s/uVPv7epz+/QayEdmF/KPuUNKwRuANZDsyxKrb6XkCkse/IquRH9Udi13AQGQH8mYBbf0JmavuYOwC+Klfb/mf7ovIB8hhC4Mv4VHCgfk55HkL40T2/RwXeCo7oe5gzALakI9S7UzvQA6kbyO7kXu9bINXRxtL20q//wtkubqDSWNi5CkLVy7DKzx3GVmMnKlhe9zZHMBHIfeRSch5dSdJrAK+RV608tPObWSG1bbzE7jT9yD7kQ3qDibEKGAhctAqn/dfQz6uY9tPWDgCbqo7mRCjgA4LErJ8Y+FLWHdNW4uc2ATw9HIs1bb0EcCrlqPqBvY3sQl438IXpKRtiYADFi4pm46YBPB6nVcmYys89wqyV93AIohJwCwLp5jswPsXMhq5q25gEcQk4B1kq5UL2Ie8rG5cUcQk4DvkBSsXwHmgnerGFYVSQCvytfXs6Ly2dFvtM6DZ2VAeXduEfc1FKeAHZJHVt3OredyFTEB+E/Y1F5WAacgvVv+nu5rHnyIrRf3sE5WA9yxMKyQ8gjxW4XVctbpV59961iKYds4jlkE4b/6nw8JpqmlxAWLUAh4v/ZxvYQo6C1e6Xqpj+5z1jHryTimAS4bfW3GDMCsgWDt0R9jHPlEK6ECeseIEcD05moWXPFQCJiOnCtw+F91ZJXdW1L+qUQngt9JXU7+z/GS8Vf5Ecw241iIqjh0rRH2rCfUgnDDIQv3mGCsXsMTCt+amJBYB5JCFMSELz+Pb1Y0ripgEvIuss/IjgJUMUdTwFEFMApYhX1q5gGsWxocudQOLICYBI5GryNAKz3E+p13dwCKISQD52UL1Q9K25GjgYv3r6sYVQWwC1ljP6ldaAGtBOad/Q93A/iY2ATwNXbdwWZqFZerr1Q3sb2ITQFgR3WblX8pYUjjd6v8GzbKXYRbuI5MTowCWlPMOFtb5Z6+I+O/z7MFrO1l1zeJcHkn71B1NOhYjm5FNOc8dsVCmcqXGbfJKipe5nAJnjakL6AXecsr5nOmpdqaPBu78tRaq5fqa7x9nQeYqC0uffL8LqAKeLjg90dLLazgefGZBFh//bqHEcUopraVkb/RwAVXC5cjPLZQm1lMXlH3OBdQAB+WvkKmpNruA/5kRFqrbeIf8kDq2w+VJ3jG/BflD3SnSKAISOCnHWlFO3D1p1R8BnRbuqOR/VXBa3Yk0jSYg3W7OGfF+YA62LaXwLsjOUljQdbwUzjFFOZvaqAKaBhcgxgWIcQFiXIAYFyDGBYhxAWJcgBgXIMYFiHEBYlyAGBcgxgWIcQFiXIAYFyDGBYhxAWJcgBgXIMYFiHEBYlyAmP8ArDD+YQAA5EkAAAAASUVORK5CYII="}
                ],
            UpdatedTime:null,
            currencyCardTitle:"Currencies",
            currencyCardButton:"More Currencies",
            'dividings': ['newsandinformationtype_dividing', 'newsandinformationtype_dividing']
        }, 
        onInit: function () {
            this.showMyMessage();
        },
        showMyMessage:function(e){
            var that = this
            var baseCurrency="TRY"
            fetch.fetch({
                url: 'https://api.exchangeratesapi.io/latest?base='+baseCurrency,
                success: function (data) {
                     let obj = JSON.parse(data.data)
                     if(!obj.error){
                         that.currencies[0].rate = "GBP : "+obj.rates["GBP"].toFixed(3)
                         that.currencies[1].rate = "EUR : "+obj.rates["EUR"].toFixed(3)
                         
                         var lastTime = new Date()
                         const day = lastTime.getDate()
                         const month = lastTime.getMonth()+1
                         const year = lastTime.getFullYear()
                         const hr = lastTime.getHours()
                         const min =lastTime.getMinutes()
                         that.UpdatedTime="Based on "+baseCurrency+"\nLast Updated : "+hr+":"+min+"\t"+day+"/"+month+"/"+year
                     }
                },
                fail: function (data, code) {
                    console.log("handling fail, code = " + code);
                }
            })
                      
        },
        redirectToApp:function(){
            //deeplink must be called this area by users
           router.push({uri:currencyPageUri});
        }       
       
    }

    try {
        // This section will check if respective native app is installed or not
        // if native app is not installed then redirection will be made to AppGallery
        app.getPackageInfo({
            packageName: packageName, // Target app package name.
            success: function (data) {
                // The app has been installed, but the version is incorrect. The system guides the user to HUAWEI AppGallery for installation.
                if (data.versionCode < data.deeplinkEnableVersionCode) {
                    // console.log("data: " + data.packageName + " " + data.versionCode + " " + data.deeplinkEnableVersionCode);
                    router.push({ uri: "appmarket://details?id=" + packageName });
                }
            },
            fail: function (errormsg, errorcode) {
                // The app is not installed. The system guides the user to HUAWEI AppGallery for installation.
                router.push({ uri: "appmarket://details?id=" + packageName });
            }
        });
    } catch (error) {
        // Use the following logic when the engine version is earlier than 1060.
        pkg.hasInstalled({
            package: packageName,
            success: function (data) {
                // The interface is called successfully. 
                console.log("handling success: " + data.result);
            },
            fail: function (data, code) {
                // The app is not installed. The system guides the user to HUAWEI AppGallery for installation.
                router.push({ uri: "appmarket://details?id=" + packageName });
            }
        });
    }

    
</script>